(()=>{"use strict";var t={85:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.BB64BitRenderer=void 0;const i=n(388);class r{static render(t,e,n){const s=[];for(const n of e){const e=t[n],o=i.createElem("div",{classList:["bb-value"]});o.innerHTML=`<div>${n}</div><div class="bit-grid">${r.getHtml(e)}</div>`,s.push(o)}n.innerHTML="",n.append(...s)}static getHtml(t,e=!1){if(null==t)return"null";const n=BB.bit_positions(t),i=[];for(let t=0;t<8;t++){let r="<tr>";for(let i=0;i<8;i++){const s=8*t+i;let o="";n.indexOf(s)>=0&&(o+=" bit-set"),e&&(o=`bit-cell bit-index-${s}`),r+=`<td ${""!=o?`class="${o}"`:""}><div><div></div></div></td>`}r+=`<td class="no-decoration"><div>${t+1}</div></td></tr>`,i.unshift(r)}let r="<tr>";for(let t=0;t<8;t++)r+=`<td class="no-decoration"><div>${String.fromCharCode(97+t)}</div></td>`;return r+='<td class="no-decoration"></td></tr>',`<table><tbody>${i.join("")}${r}</tbody></table>`}}e.BB64BitRenderer=r},688:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.BBEditor=void 0;const i=n(388),r="#observe ";e.BBEditor=class{constructor(){this.context={},this.observeVars=[],this.error=null,this.execute=(t,e)=>{if(this.code=t,this.context=e,this.observeVars=[],this.error=null,""==t)return;let n=t.split("\n"),s=0==n[0].startsWith(r);0==s&&(this.observeVars=i.cleanArray(n[0].substr(r.length).split(",")),n=n.slice(1));let o=0;e=i.copyContext(e);for(let t of n){if(t=t.trim(),""==t)continue;if(t.startsWith("//"))continue;const n=i.cleanArray(t.split("="));if(n.length<2)return void(this.error=`Error line: ${o}, malformed assignment. Should be "var_name = expression"`);const[r,l]=[n[0],n.slice(1).join("=")];try{e[r]=BigInt.asUintN(64,BigInt(new Function(`${this._createFunctionContext(e)}\nreturn ${l};`)()))}catch(t){return void(this.error=`Error line: ${o+1}, ${t}`)}1==s&&this.observeVars.indexOf(r)<0&&this.observeVars.push(r),o++}this.context=e}}_createFunctionContext(t){return Object.keys(t).map((e=>`var ${e} = ${t[e]}n;`)).join("\n")}}},17:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.BBMembers=e.installBBFunctions=void 0;const n=[0,1,2,19,10,3,20,28,25,11,14,4,21,56,39,29,17,26,12,37,15,47,5,49,7,22,44,57,60,40,51,30,63,18,9,27,24,13,55,38,16,36,46,48,6,43,59,50,62,8,23,54,35,45,42,58,61,53,34,41,52,33,32,31],i=0x2c4a191fa76af37n,r={RANKS:[0xffn,0xff00n,0xff0000n,0xff000000n,0xff00000000n,0xff0000000000n,0xff000000000000n,0xff00000000000000n],FILES:[0x101010101010101n,0x202020202020202n,0x404040404040404n,0x808080808080808n,0x1010101010101010n,0x2020202020202020n,0x4040404040404040n,0x8080808080808080n],SQUARES:[],SQUARE_RANK:[],SQUARE_FILE:[],ROOK_ATTACKS:{NORTH:[],EAST:[],SOUTH:[],WEST:[]},BISHOP_ATTACKS:{NORTH_EAST:[],SOUTH_EAST:[],NORTH_WEST:[],SOUTH_WEST:[]},KNIGHT_ATTACKS:[],KING_ATTACKS:[],bsf:t=>0n==t?0:n[Number((t&-t)*i>>58n&0x3fn)]+1,bit_reverse:t=>(t=(0x00ff00ff00ff00ffn&(t=(0x0f0f0f0f0f0f0f0fn&(t=(0x3333333333333333n&(t=(0x5555555555555555n&t)<<1n|t>>1n&0x5555555555555555n))<<2n|t>>2n&0x3333333333333333n))<<4n|t>>4n&0x0f0f0f0f0f0f0f0fn))<<8n|t>>8n&0x00ff00ff00ff00ffn)<<48n|(0xffff0000n&t)<<16n|t>>16n&0xffff0000n|t>>48n,byte_swap(t){let e=(0xffn&t)<<56n;return e|=(t>>8n&0xffn)<<48n,e|=(t>>16n&0xffn)<<40n,e|=(t>>24n&0xffn)<<32n,e|=(t>>32n&0xffn)<<24n,e|=(t>>40n&0xffn)<<16n,e|=(t>>48n&0xffn)<<8n,e|=t>>56n&0xffn,e},bit_positions(t){const e=[];for(;0n!=t;){const n=r.bsf(t);if(0==n)break;e.push(n-1),t&=t-1n}return e},sliding_attacks_diag(t,e,n){if(0n==n)return 0n;const i=r.SQUARES[e];let s=t&n,o=r.byte_swap(s);return s-=i,o-=r.byte_swap(i),s^=r.byte_swap(o),s&n},sliding_attacks_h(t,e){const n=r.SQUARES[e],i=r.bit_reverse(t),s=r.bit_reverse(n);return(t-2n*n^r.bit_reverse(i-2n*s))&r.SQUARE_RANK[e]},sliding_attacks_v:(t,e,n)=>r.sliding_attacks_diag(t,e,n),from_fen(t){if(""==(t=(t||"").trim()))return 0n;const e=t.split(" ").shift().split("/").map((t=>t.split("")));if(8!=e.length||e.some((t=>0==t.length)))return 0n;let n=e.map((t=>{let e="";for(let n of t){const t=Number(n);isNaN(t)?e+="1":e+=new Array(t+1).map((t=>"")).join("0")}return e})).reverse().join("");return BigInt(`0b${n}`)}};function s(t,e){const n=t%8,i=(t-n)/8;let s=0n;return e.forEach((t=>{let e=n+t[0],o=i+t[1];for(;e>=0&&o>=0&&e<=7&&o<=7;){const n=e+8*o;s|=r.SQUARES[n],e+=t[0],o+=t[1]}})),s}!function(){for(let t=0;t<64;t++){r.SQUARES[t]=2n**BigInt(t);const e=t/8,n=t%8;r.SQUARE_RANK[t]=r.RANKS[e],r.SQUARE_FILE[t]=r.FILES[n]}}(),function(){for(let t=0;t<64;t++)r.ROOK_ATTACKS.NORTH[t]=s(t,[[0,1]]),r.ROOK_ATTACKS.EAST[t]=s(t,[[1,0]]),r.ROOK_ATTACKS.SOUTH[t]=s(t,[[0,-1]]),r.ROOK_ATTACKS.WEST[t]=s(t,[[-1,0]])}(),function(){for(let t=0;t<64;t++)r.BISHOP_ATTACKS.NORTH_EAST[t]=s(t,[[1,1]]),r.BISHOP_ATTACKS.NORTH_WEST[t]=s(t,[[-1,1]]),r.BISHOP_ATTACKS.SOUTH_EAST[t]=s(t,[[1,-1]]),r.BISHOP_ATTACKS.SOUTH_WEST[t]=s(t,[[-1,-1]])}();const o=0xffffffffffffffffn,l=o^r.FILES[0],c=o^(r.FILES[0]|r.FILES[1]),d=o^r.FILES[7],a=o^(r.FILES[6]|r.FILES[7]),u=o^r.RANKS[0],f=o^(r.RANKS[0]|r.RANKS[1]),E=o^r.RANKS[7],m=o^(r.RANKS[6]|r.RANKS[7]);!function(){for(let t=0;t<64;t++){const e=r.SQUARES[t];let n=0n;n|=e<<17n&l&f,n|=e<<10n&c&u,n|=e<<15n&d&f,n|=e<<6n&a&u,n|=e>>17n&d&m,n|=e>>10n&a&E,n|=e>>15n&l&m,n|=e>>6n&c&E,r.KNIGHT_ATTACKS[t]=n}}(),function(){for(let t=0;t<64;t++){const e=r.SQUARES[t];let n=0n;n|=e<<1n&l,n|=e<<9n&l&u,n|=e<<8n&u,n|=e<<7n&d&u,n|=e>>1n&d,n|=e>>9n&d&E,n|=e>>8n&E,n|=e>>7n&l&E,r.KING_ATTACKS[t]=n}}();const _=t=>Object.keys(t).map((e=>{const n=t[e],i=Object.prototype.toString.apply(n);let r=null;if(i.indexOf("Function")>=0){let t=n.toString();t=t.substr(0,t.indexOf("{")).trim(),t=t.replace("Function",e),r=t}else r=i.indexOf("Array")>=0?typeof n[0]+"[]":i.indexOf("Object")>=0?"{\n"+_(n).map((t=>`  ${t.name}: ${t.title}`)).join("\n")+"\n}":typeof n;return{name:e,title:r}}));e.installBBFunctions=()=>{window.BB=r},e.BBMembers=_(r)},309:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.BBService=void 0;const i=n(17),r=n(85),s=n(688),o=n(388),l=n(533);let c=0;var d;!function(t){t.Execute="exec",t.InsertEditorBefore="ibefore",t.InsertEditorAfter="iafter",t.RemoveEditor="remove"}(d||(d={})),e.BBService=class{constructor(){this._editorElems={},this._contextElem=null,this._editorsContainerElem=null,this._context={},this._editors={},this._focusedEditorId=null,this._handleMouseClick=t=>{if(Object.keys(this._editors).length>0&&null==this._focusedEditorId)return;const e=(t.target.id||"").trim();if(0!=e.startsWith("btn@"))switch(e.split("@").pop()){case d.RemoveEditor:this._removeEditor(this._focusedEditorId);break;case d.InsertEditorBefore:this._addEditor(this._focusedEditorId,"before");break;case d.InsertEditorAfter:this._addEditor(this._focusedEditorId,"after");break;case d.Execute:this._execute(this._focusedEditorId)}},this._handleKeyboardPress=t=>{if("Enter"==t.key&&t.ctrlKey){const e=this._findEditorIdFromCmTexare(t.target);null!=e&&this._execute(e)}},this._execute=t=>{this._editors[t]=this._editors[t]||new s.BBEditor;const e=this._editors[t],n=this._editorElems[t].editorElem,i=(this._editorElems[t].codeMirrorEditor.getDoc().getValue("\n")||"").trim();e.execute(i,o.copyContext(this._context));let l=this._editorElems[t].resultElem;null==l&&(l=o.createElem("pre",{id:`${t}-result`,classList:["bb-editor-result"]}),this._editorElems[t].resultElem=l,n.parentElement.append(l)),null!=e.error?l.textContent=e.error:(this._context=o.copyContext(e.context),this._updateContextViewer(),r.BB64BitRenderer.render(this._context,e.observeVars,l))},this._addEditor=(t=null,e="after")=>{c++;let n=null;const i=`bb-editor-${c}`,r=o.createElem("div",{id:i,classList:["bb-editor"]},[n=o.createElem("textarea",{id:`${i}@code`,classList:["bb-editor-code"]})]);if(r.dataset.editorId=i,null==t)this._editorsContainerElem.appendChild(r);else{const n=this._editorElems[t].editorElem.parentElement;"before"==e?n.before(r):n.after(r)}const s=CodeMirror.fromTextArea(n,{viewportMargin:1/0});this._editorElems[r.id]={editorElem:n,resultElem:null,codeMirrorEditor:s},s.on("focus",this._handleCmFocus),s.focus()},this._removeEditor=t=>{if(""==(t=(t||"").trim()))return;if(null==this._editorElems[t])return;const e=this._editorElems[t].codeMirrorEditor;e.off("focus",this._handleCmFocus),e.toTextArea();const n=this._editorElems[t].editorElem?.parentElement;null!=n&&n.remove(),this._editorElems[t]=null,this._focusedEditorId==t&&(this._focusedEditorId=null)},this._handleCmFocus=(t,e)=>{const n=this._findEditorIdFromCmTexare(e.target);null!=n&&(null!=this._focusedEditorId&&n!=this._focusedEditorId&&this._editorElems[this._focusedEditorId].editorElem.parentElement.classList.remove("editor-focused"),this._editorElems[n].editorElem.parentElement.classList.add("editor-focused"),this._focusedEditorId=n)},this._updateContextViewer=()=>{const t=Object.keys(this._context).sort().map((t=>{const e=this._context[t];return`<tr><td>${t}<ul>${[e.toString(10),"0x"+e.toString(16),"0b"+e.toString(2)].map(((t,e)=>`<li${0==e?' class="decimal"':""} title="${t}">${t}</li>`)).join("")}</ul></td></tr>`})).join("\n");this._contextElem.innerHTML=`<table><tbody>${t}</tbody></table>`},this._findEditorIdFromCmTexare=t=>{let e=t;for(;null!=e&&null==e.dataset.editorId;)e=e.parentElement;return null!=e?e.dataset.editorId:null},document.onreadystatechange=()=>{if("complete"==document.readyState){let t;console.log("let's go!"),i.installBBFunctions(),this._BBValueEditor=new l.BBValueEditor,document.getElementsByClassName("bb-main").item(0).append(o.createElem("div",{classList:["bb-context"]},[o.createElem("h4",{content:"Context"}),this._contextElem=o.createElem("div")]),o.createElem("div",{classList:["bb-editors-container"]},[o.createElem("h4",{content:"Code"}),o.createElem("div",{classList:["bb-editor-toolbar"]},[o.createElem("button",{id:"btn@exec",content:"execute",title:"Execute",icon:"execute"}),o.createElem("button",{id:"btn@iafter",content:"below",title:"Insert new editor below",icon:"add"}),o.createElem("button",{id:"btn@ibefore",content:"above",title:"Insert new editor above",icon:"add"}),o.createElem("button",{id:"btn@remove",content:"remove",title:"Remove editor",icon:"remove"})]),this._editorsContainerElem=o.createElem("div",{classList:["bb-editors-list"]})]),o.createElem("div",{classList:["bb-helpers"]},[o.createElem("div",{classList:["bb-value-editor"]},this._BBValueEditor.getHtmlElements()),o.createElem("div",{classList:["bb-custom-functions"]},[function(){const t=o.createElem("h4");return t.textContent="Custom vars/funcs",t}(),t=o.createElem("ul")])])),this._addEditor(),t.append(...i.BBMembers.map((t=>{const e=o.createElem("li");return e.textContent=t.name,e.title=t.title,e}))),document.addEventListener("click",this._handleMouseClick),document.addEventListener("keydown",this._handleKeyboardPress)}}}}},533:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.BBValueEditor=void 0;const i=n(85),r=n(388);e.BBValueEditor=class{constructor(){this._value=0n,this.getHtmlElements=()=>{const t=[r.createElem("h4",{content:"Bit editor"}),this._gridElem=r.createElem("div",{classList:["bit-grid"]}),r.createElem("table",{classList:["value-radix"]},[r.createElem("tr",null,[r.createElem("td",{content:"dec"}),r.createElem("td",null,[this._decInputElem=r.createElem("input")])]),r.createElem("tr",null,[r.createElem("td",{content:"hex"}),r.createElem("td",null,[this._hexInputElem=r.createElem("input")])]),r.createElem("tr",null,[r.createElem("td",{content:"bin"}),r.createElem("td",null,[this._binInputElem=r.createElem("input")])])])];return this._gridElem.innerHTML=i.BB64BitRenderer.getHtml(this._value,!0),this._decInputElem.type="text",this._decInputElem.readOnly=!0,this._hexInputElem.type="text",this._hexInputElem.readOnly=!0,this._binInputElem.type="text",this._binInputElem.readOnly=!0,this._updateDisplay(),document.addEventListener("click",this._onCellClick),t},this._updateDisplay=()=>{this._decInputElem.value=this._value.toString(10),this._hexInputElem.value="0x"+this._value.toString(16).toUpperCase(),this._binInputElem.value="0b"+this._value.toString(2)},this._onCellClick=t=>{let e=t.target;for(;null!=e&&0==e.classList.contains("bit-cell");)e=e.parentElement;if(null!=e){const t=parseInt(Array.prototype.slice.apply(e.classList).filter((t=>t.indexOf("bit-index")>=0)).pop().split("-").pop()),n=1n<<BigInt(t);(this._value&n)>0?(this._value^=n,e.classList.remove("bit-set")):(this._value|=n,e.classList.add("bit-set")),this._updateDisplay()}}}}},388:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.createIcon=e.createElem=e.copyContext=e.cleanArray=void 0,e.cleanArray=t=>t.map((t=>t?.trim())).filter((t=>null!=t&&""!=t)),e.copyContext=t=>{const e={};return Object.keys(t).forEach((n=>e[n]=t[n])),e},e.createElem=(t,n=null,i=null)=>{const r=document.createElement(t);null!=n?.id&&(r.id=n.id),n?.classList?.length>0&&r.classList.add(...n.classList);const s=n?.title?.trim();if(null!=s&&(r.title=s),i?.length>0)r.append(...i);else{null!=n?.icon&&r.appendChild(e.createIcon(n.icon));const t=n?.content?.trim();null!=t&&r.append(t)}return r},e.createIcon=t=>{const e=document.createElement("img");return e.src=`images/${t}.png`,e.textContent=t,e}},312:(t,e,n)=>{new(n(309).BBService)}},e={};!function n(i){if(e[i])return e[i].exports;var r=e[i]={exports:{}};return t[i](r,r.exports,n),r.exports}(312)})();
//# sourceMappingURL=main.js.map